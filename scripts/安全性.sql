--创建服务器登录名、用户，并赋予相关权限
--用户权限分为三级：
				--1.最高权限赋予图书管理部管理员（主管）
				--2.对图书管理部员工的授权，授予低于部门主管高于普通员工的操作权限，
					--因为需要对数据库进行相关除书籍查询以外的其他操作
				--3.对公司所有其他部门普通员工用户的授权，只授予对书籍信息的查询权限，
					--如果员工需要借书需要到图书管理部员工处办理借阅手续
use BookManageOS

--创建图书管理部账号（服务器登录名+用户名），并对图书管理部授予最高权限
CREATE LOGIN  图书管理部
	WITH PASSWORD='UIsdaiod$aoho398' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER 图书管理部 FOR LOGIN 图书管理部
USE BookManageOS
GRANT create table,DELETE,ALTER,UPDATE,SELECT  TO  图书管理部  WITH GRANT OPTION



--创建图书管理部员工账号（服务器登录名+用户名），并对图书管理部员工授权部分修改、删除及插入数据的权限
CREATE LOGIN  u201901060818
	WITH PASSWORD='UIsdaiod$aoho398' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201901060818 FOR LOGIN u201901060818
USE BookManageOS
GRANT DELETE,UPDATE,SELECT  TO  u201901060818

CREATE LOGIN  u202001061018
	WITH PASSWORD='HSSsaiu$ho11h4o' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001061018 FOR LOGIN u202001061018
USE BookManageOS
GRANT DELETE,UPDATE,SELECT  TO  u202001061018



--创建公司所有其他部门普通员工的账号（服务器登录名+用户名）
CREATE LOGIN u201701461265
	WITH PASSWORD='WiohSUI$248HSihk' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201701461265 FOR LOGIN u201701461265

CREATE LOGIN u201701662388
	WITH PASSWORD='KISdwop$dj12' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201701662388 FOR LOGIN u201701662388

CREATE LOGIN  u201701894515
	WITH PASSWORD='HJKSJdsjl$cs132' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201701894515 FOR LOGIN u201701894515

CREATE LOGIN u201701894545
	WITH PASSWORD='IJOddadjo$131' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201701894545 FOR LOGIN u201701894545

CREATE LOGIN u201801057856
	WITH PASSWORD='SxasUI$28Sihk' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201801057856 FOR LOGIN u201801057856

CREATE LOGIN u201801068793
	WITH PASSWORD='SJIOowsdih$xs112' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201801068793 FOR LOGIN u201801068793

CREATE LOGIN  u201901054789
	WITH PASSWORD='SHIOSH$lwsq123' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201901054789 FOR LOGIN u201901054789

CREATE LOGIN u201901056874
	WITH PASSWORD='dsohHOIHI87$ds' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201901056874 FOR LOGIN u201901056874

CREATE LOGIN u201901060817
	WITH PASSWORD='NSsakjh$sak12' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201901060817 FOR LOGIN u201901060817

CREATE LOGIN u201904613477
	WITH PASSWORD='HShohi$sdl132' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u201904613477 FOR LOGIN u201904613477

CREATE LOGIN  u202001041259
	WITH PASSWORD='SGUIsj$89hj' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001041259 FOR LOGIN u202001041259

CREATE LOGIN u202001060122
	WITH PASSWORD='OSHohkasj$asl786' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001060122 FOR LOGIN u202001060122

CREATE LOGIN u202001064578
	WITH PASSWORD='SHSIOda$oi543' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001064578 FOR LOGIN u202001064578

CREATE LOGIN u202001067812
	WITH PASSWORD='HOodho&9789' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001067812 FOR LOGIN u202001067812

CREATE LOGIN  u202001068426
	WITH PASSWORD='IOHDo$hdiao67' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001068426 FOR LOGIN u202001068426

CREATE LOGIN  u202001458748
	WITH PASSWORD='IOHDo$hdiao67' MUST_CHANGE,
	DEFAULT_DATABASE = BookManageOS,
	CHECK_EXPIRATION = ON,
	CHECK_POLICY = ON
CREATE USER u202001458748 FOR LOGIN u202001458748



--授予包括公司所有其他部门普通员工在内的所有账号对图书信息的查找权限
GRANT SELECT ON Books  TO PUBLIC

--查询目前数据库的用户
exec sp_helpuser


--查询某个账号有哪些权限，直接授权给账号的,而不是通过角色继承来的
select USER_NAME(p.grantee_principal_id) AS principal_name,
        p.grantee_principal_id,
        dp.principal_id,
        dp.type_desc AS principal_type_desc,
        p.class_desc,
        OBJECT_NAME(p.major_id) AS object_name,
        p.permission_name,
        p.state_desc AS permission_state_desc
from sys.database_permissions p 
        INNER JOIN sys.database_principals dp on  p.grantee_principal_id = dp.principal_id 
where USER_NAME(p.grantee_principal_id) = '图书管理部'